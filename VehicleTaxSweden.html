<!DOCTYPE html>

<html lang="sv">

<title>Fordonsskatteuträkning</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<body class="bg-dark text-light">
    <div class="container my-5" style="max-width: 500px;">
        <!-- This section is the form for inputting details regarding the vehicle -->
        <form onsubmit="event.preventDefault(); doTaxCalculation();">
            <div class="form-group">
                <p>
                    <label for="co2output"><b>Antal gram co<sub>2</sub> per kilometer</b></label>
                    <input class="form-control" type="number" name="co2output" id="co2output" placeholder="gram koldioxid per kilometer" required>
                    <small class="form-text text-muted">Utsläpp vid blandad k&ouml;rning</small>
                </p>
            </div>
            <div class="form-group">
                <p>
                    <label for="modelYear"><b>Fordonets modellår</b></label>
                    <input class="form-control" type="number" name="modelYear" id="modelYear" placeholder="YYYY" required>
                </p>
            </div>
            <div class="form-group">
                <div class="form-check">
                    <p>
                        <b>Bränsletyp</b>
                    </p>
                    <p>
                        <input class="form-check-input" type="radio" name="fuel" id="bensin" value="bensin" checked>
                        <label for="bensin" class="form-check-label">Bensin</label>
                    </p>
                    <p>
                        <input class="form-check-input" type="radio" name="fuel" id="diesel" value="diesel">
                        <label for="diesel" class="form-check-label">Diesel</label>
                    </p>
                    <p>
                        <input class="form-check-input" type="radio" name="fuel" id="eco" value="eco">
                        <label for="eco" class="form-check-label">E85/CNG eller annat miljövänligt alternativ</label>
                    </p>
                </div>
            </div>
            <div class="container mx-auto text-center">
                <input type="submit" class="btn btn-secondary" onclick="doTaxCalculation()" value="RÄKNA UT!">
            </div>
        </form>
    </div>
    <!-- Results will be displayed after calculations -->
    <div id="results" class="container my-5" style="max-width: 500px;">
        <div class="table-responsive" id="tableBonusMalus" style="display: none">
            <table class="table table-bordered table-dark">
                <thead>
                    <tr>
                        <th colspan="2" class="text-center">Årlig fordonsskatt</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">Första tre åren</th>
                        <td><span id="vehicleTaxBonusMalus"></span></td>
                    </tr>
                    <tr>
                        <th scope="row">Efterföljande år</th>
                        <td><span id="vehicleTax"></span></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="table-responsive" id="tableVehicleTax" style="display: none">
            <table class="table table-bordered table-dark">
                <thead>
                    <tr>
                        <th colspan="2" class="text-center">Årlig fordonsskatt</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="text-center"><span id="vehicleTaxOld"></span></td class="text-center">
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
<!-- Bootstrap JavaScript -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<!-- JS for the calculations -->
<script src="VehicleTaxSweden.js"></script>
<script>
// Set current year in model year input box as default
document.getElementById('modelYear').value = new Date().getFullYear();

function doTaxCalculation() {
    // Set up variables
    var userCarbonInput, userModelYearInput, taxOutput, taxOutputBonusMalus;
    var isBonusMalus = false, isDiesel = false, isEcoFuel = false;
    var vehicleTax, vehicleTaxBonusMalus;

    // Bind page elements to variables
    taxOutput = document.getElementById('vehicleTax');
    taxOutputBonusMalus = document.getElementById('vehicleTaxBonusMalus');
    taxOutputOld = document.getElementById('vehicleTaxOld');

    // Get user input
    userCarbonInput = parseInt(document.getElementById('co2output').value);
    userModelYearInput = parseInt(document.getElementById('modelYear').value);

    // Check type of fuel
    if (document.getElementById('bensin').checked == true) {
        isBonusMalus = true;
    }
    if (document.getElementById('diesel').checked == true) {
        isBonusMalus = true;
        isDiesel = true;
    }
    if (document.getElementById('eco').checked == true) {
        isBonusMalus = false;
        isEcoFuel = true;
    }

    // Set up calculations
    vehicleTax = parseInt(VehicleTaxCalculation(userCarbonInput,userModelYearInput,false,isDiesel,isEcoFuel));
    vehicleTaxBonusMalus = parseInt(VehicleTaxCalculation(userCarbonInput,userModelYearInput,true,isDiesel,isEcoFuel));

    // Display elements and output to page
    document.getElementById('results').style.display = "block";
    if (userModelYearInput >= 2018 && isBonusMalus == true) {
        document.getElementById('tableBonusMalus').style.display = "";
        document.getElementById('tableVehicleTax').style.display= "none";
        taxOutputBonusMalus.textContent = vehicleTaxBonusMalus + " kr";
        taxOutput.textContent = vehicleTax + " kr";
    }
    else {
        document.getElementById('tableBonusMalus').style.display = "none";
        document.getElementById('tableVehicleTax').style.display= "";
        taxOutputOld.textContent = vehicleTax + " kr";
    }

    // Save input data to local storage for later use
    sessionStorage.setItem('carbonInput',userCarbonInput);
    sessionStorage.setItem('modelYear', userModelYearInput);
    
    // Debug...
    /*
    console.log("Carbon input:", userCarbonInput);
    console.log("Current year:", new Date().getFullYear());
    console.log("Model year: ", userModelYearInput);
    console.log("Bonus/Malus: ",isBonusMalus);
    console.log("Diesel: ",isDiesel);
    console.log("Eco fuel: ",isEcoFuel);
    */
}

// Populate form elements with saved data
window.onload = function() {
    document.getElementById("co2output").value = sessionStorage.getItem("carbonInput");
    document.getElementById("modelYear").value = sessionStorage.getItem("modelYear");
}

window.onload = function() {
    document.getElementById("co2output").value = sessionStorage.getItem("carbonInput");
    document.getElementById("modelYear").value = sessionStorage.getItem("modelYear");
}
</script>

</body>
</html>